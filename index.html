<html>

<head>
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.4/dist/instantsearch.min.css">
    <script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.4"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.4/dist/instantsearch-theme-algolia.min.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
</head>

<body>
    <div id="search-bar"></div>
    <button id="mic"><i class="fas fa-microphone"></i></button>
    <div id="hits"></div>
</body>


<script>
    const search = instantsearch({
        appId: 'latency',
        apiKey: '6be0576ff61c053d5f9a3225e2a90f76',
        indexName: 'instant_search',
        routing: true
    });

    search.addWidget(
        instantsearch.widgets.hits({
            container: '#hits',
            templates: {
                empty: 'No results',
                item: '<em>Hit {{objectID}}</em>: {{{_highlightResult.name.value}}}'
            }
        })
    );

    search.addWidget(
        instantsearch.widgets.searchBox({
            container: '#search-bar',
            placeholder: 'Search for products',
        })
    );

    search.addWidget({
        init: function(initOptions) {
            console.log("initOpts", initOptions);
            const micBtn = document.querySelector('#mic');

            /*** Google Chrome API ***/
            
            window.SpeechRecognition = window.webkitSpeechRecognition || window.SpeechRecognition;

            if ('SpeechRecognition' in window) {
                console.log("Chrome API is working");
                var recognition = new webkitSpeechRecognition();

                recognition.interimResults = true;

                recognition.onresult = function(event) { 
                    console.log(event.results[0][0]);
                    let query = event.results[0][0].transcript;
                    initOptions.helper.setQuery(query).search(); //Set the query and search
                    micBtn.innerHTML = '<i class="fas fa-microphone"></i>';    
                }
            } else {
                console.log("Speech recognition Chrome API not supported");
            }
            

            //Start mic on click
            micBtn.addEventListener('click', function(e){
                recognition.start(); //Chrome API
                micBtn.innerHTML = '<i class="fas fa-dot-circle" style="color: red;"></i>';
            })
        },
    });

    search.start();

</script>

</html>